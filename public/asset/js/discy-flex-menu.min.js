(function(a){typeof define=='function'&&define.amd?define(['jquery'],a):a(jQuery)})(function(a){var c=a(window).width(),d=a(window).height(),b=[],e;function f(){(a(window).width()!==c||a(window).height()!==d)&&(a(b).each(function(){a(this).flexMenu({undo:!0}).flexMenu(this.options)}),c=a(window).width(),d=a(window).height())}function g(d){var b,c;b=a('li.flexMenu-viewMore.active'),c=b.not(d),c.removeClass('active').find('> ul').hide()}a(window).resize(function(){clearTimeout(e),e=setTimeout(function(){f()},200)}),a.fn.flexMenu=function(e){var d,c=a.extend({threshold:2,cutoff:2,linkText:'More',linkTitle:'View More',linkTextAll:'Menu',linkTitleAll:'Open/Close Menu',showOnHover:!0,popupAbsolute:!0,popupClass:'',undo:!1},e);return this.options=c,d=a.inArray(this,b),d>=0?b.splice(d,1):b.push(this),this.each(function(){var b=a(this),l=b.find('> li'),k=l.first(),t=l.last(),m=b.find('li').length,s=Math.floor(k.offset().top),r=Math.floor(k.outerHeight(!0)),i,q,f,n,o,p=!1,h,e,d;function j(a){var b=Math.ceil(a.offset().top)>=s+r;return b}if(j(t)&&m>c.threshold&&!c.undo&&b.is(':visible')){d=a('<ul class="flexMenu-popup" style="display:none;'+(c.popupAbsolute?' position: absolute;':'')+'"></ul>'),d.addClass(c.popupClass);for(e=m;e>1;e--){if(i=b.find('> li:last-child'),q=j(i),e-1<=c.cutoff){a(b.children().get().reverse()).appendTo(d),p=!0;break}if(!q)break;i.appendTo(d)}p?b.append('<li class="flexMenu-viewMore flexMenu-allInPopup"><a href="#" title="'+c.linkTitleAll+'">'+c.linkTextAll+'</a></li>'):b.append('<li class="flexMenu-viewMore"><a href="#" title="'+c.linkTitle+'">'+c.linkText+'</a></li>'),f=b.find('> li.flexMenu-viewMore'),j(f)&&b.find('> li:nth-last-child(2)').appendTo(d),d.children().each(function(b,a){d.prepend(a)}),f.append(d),n=b.find('> li.flexMenu-viewMore > a'),n.click(function(a){g(f),d.toggle(),f.toggleClass('active'),a.preventDefault()}),c.showOnHover&&typeof Modernizr!='undefined'&&!Modernizr.touch&&f.hover(function(){d.show(),a(this).addClass('active')},function(){d.hide(),a(this).removeClass('active')})}else if(c.undo&&b.find('ul.flexMenu-popup')){h=b.find('ul.flexMenu-popup'),o=h.find('li').length;for(e=1;e<=o;e++)h.find('> li:first-child').appendTo(b);h.remove(),b.find('> li.flexMenu-viewMore').remove()}})}})